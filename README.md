# FreeRTOS-demo
Basic FreeRTOS demo with the use of the CMSIS wrapper (v2) and configuration guide for use in other projects.

## FreeRTOS Configuration Guide
Good introduction to enabling FreeRTOS in STM32CubeIDE:  
https://youtu.be/OPrcpbKNSjU  

Summary of above video:
1. To enable FreeRTOS, go to Middleware in the project .ioc file and change FREERTOS from "Disable" to "CMSIS_V2".
2. Go to System Core in the .ioc file and change the timebase source of SYS from "SysTick" to "TIM6" or "TIM7" (to prevent conflict between FreeRTOS scheduling and HAL using the SysTick timer to count the time since restart).
3. To add Tasks (threads), go to FREERTOS in Middleware and go to Tasks and Queues, from there tasks can be added, edited, or removed. 

Tasks:
- Priority: If two tasks need to be executed at the same time, the task with the higher priority will execute first (see demo projects).
- Task Name: Name of the task.
- Entry Function: Name of the function that is associated with that task.

How to use the newly created tasks in your project?  
The main while(1) loop that is generated by the IDE should not be used. All user code in main.c should go into the task entry functions (scroll towards the bottom of the main.c file).

osDelay(ms) is used in the task functions to set the interval of execution.  
osThreadTerminate(NULL) can be placed after the forever loop in the task functions to terminate the thread in case the loop breaks accidentally.

**More to be added later as the need arises.**

## H7 Demo
Each task prints the time between execution (115200 baud) and has a counter loop that creates a delay between execution for lower priority tasks.
- blink1 (above normal priority)
- blink2 (normal priority)
- blink3 (below normal priority)

blink1: Blinks the green LED (LD1) every 1000ms   
blink2: Blinks the orange LED (LD2) every 1500ms  
blink3: Blinks the red LED (LD3) every 2000ms  

*Observation*: blink1 always has a delay of 1000ms between executions while blink2 and blink3 may have longer delays than their expected 1500ms and 2000ms respectively. This demonstrates how blink1 is prioritized higher than the other tasks.

## G431 Demo
Both tasks print the delay between execution (115200 baud) and have a counter loop that creates a delay between execution (only affects lower priority).  
- blink (normal priority)  
- printHello (low priority)  

blink: Blinks the green LED (LD2) every 1000ms  
printHello: Prints "Hello World!" every 1500ms  

*Observation*: blink always has a delay of 1000ms between executions while printHello may have longer delays than its expected 1500ms. This demonstrates how blink is prioritized higher than printHello.
